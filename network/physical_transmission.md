---
layout: page
title: Physical Transmission
---

* digital modulation
    * ビットとシグナルの変換
* エンコーディング
    * ストリーム内のすべてのビットを正しく認識すること
* フレーミング
    * パケット境界を正しく認識すること



## Baseband transmission

### Manchester encoding : マンチェスター符号化

* クロック信号とデータ信号のXOR
* クロック
    * ビット周期の前半がハイ、後半がロー
* それぞれのビットに対して2回の信号変化が必要
    * bandwidth の利用が非効率

### NRZ : Non-Return-to-Zero 比ゼロ復帰

* 論理値が1の場合に送信し、論理値が0の時に送信しない
* 信号は最大2ビットごとに正と負のレベルの間を循環する可能性がある（1と0が交互になっている場合）。
    * ビットレートがBビット/秒の場合、少なくとも B / 2Hzの帯域幅が必要
* 連続する 0　bit と アイドル状態 の区別がつかない。
* 連続する0または1がある場合、受信者は正確にカウントできないことがある。
    * もし受信者のクロックが少し速い（または遅い）場合、送信者の送信した0または1の数と、受信者の認識した0または1の数が異なる。
    * 5つの1が送信者から送られたが、 受信者のクロックが10％早ければ、5.5の単位時間の間1が続いたことになる。
    * 5つの1が送信者から送られたが、 受信者のクロックが20％早ければ、6の単位時間の間1が続いたことになる(6つの1が送信されたことになる)。
    * 正確なクロックがあれば解決できるが、高価なソリューションとなる。

### NRZI : NRZ Inverted

* USB で利用されている。
* 論理値0の送信時には信号レベルを変化させない、論理値1の送信時には前の状態を反転させる
* 論理値の変化を最小限にして、信号を複合する回路にクロック情報を提供する
* 連続する0がある場合、受信者は正確にカウントできないことがある。
    * 1が連続してもNRZのような問題にはならない(本当か？)

<!--
ビットスタッフィングルール
7bit送信後、奇数パリティ
-->

### 4B/5B

16通り のデータ送信パターンと、
6通りの特別なシグナル送信パターンがある。

| data | pattern |
|:--|:--|
| 0000 | 11110 |
| 0001 | 01001 |
| 0010 | 10100 |
| 0011 | 10101 |
| 0100 | 01010 |
| 0101 | 01011 |
| 0110 | 01110 |
| 0111 | 01111 |
| 1000 | 10010 |
| 1001 | 10011 |
| 1010 | 10110 |
| 1011 | 10111 |
| 1100 | 11010 |
| 1101 | 11011 |
| 1110 | 11100 |
| 1111 | 11101 |
| IDLE | 11111 |
| HALT | 00100 |
| START | 10001 |
| END | 01101 |
| RESET | 00111 |
| DEAD | 00000 |


## Framing

* パケットの終端を見つける方法
    * パケット間ギャップ（イーサネットなど）
    * 4B/5B および 特別なビットパターン
    * ヘッダーに長さフィールドを配置する
        * 原則として機能するが、広く使用されていない。
        * 非同期化後に順序を復元することが難しい場合がある。

### HDLC（High-level Data Link Control, 高水準電装制御手順）

* Point-to-Point Protocol（PPP）（PPPoE - PPP over Ethernet - に使用される）を含む多くのアプリケーションで使用される一般的なリンクレベルのパケット形式
* 全二重通信方式の通信プロトコル
* 電装効率と信頼性が高い
* フレーム単位でデータを伝送し、フレームごとにエラー検出のためのCRCコードをつけて送信する。
* IBM の SDLCを基本としている。
* 非同期シリアル回線
    * バイト間で、ある種の開始/停止表示がある回線。
    * 遅くなる傾向がある。
    * HDLCは バイト `0x7D`をエスケープ文字として使用する。
    * `0x7D` および `0x7E` のデータバイトは、それらの前に追加の `0x7D` を付けることでエスケープされる。
        * 実際には、 `0x7D` の後に（original_byte xor 0x20）が続くものとして送信される
    * Cプログラミング言語の文字列で使用される戦略と基本的に同じ文字列の区切り文字は「」で、エスケープ文字は「\」です。文字列内での「または\ 」の出現は、それらの前に\を付けることでエスケープされます。

* 同期シリアル回線（通常は非同期よりも高速）では、HDLCは通常ビットスタッフィングを使用します。基礎となるビットエンコーディングには、たとえば、NRZIの逆が含まれ、遷移は0ビットを示し、遷移の欠如は1ビットを示します。これは、1の長時間の実行が問題になり、0の実行が安全であることを意味します。


* フレームリレー
    * 通信回線を介して多くのサイトにIPパケットを配信するための低レベルプロトコル。
* フレーム分離のために2つの方法をサポートしています。
    * 非同期リンクを介したHDLC : バイトスタッフィング
    * 同期リンクを介したHDLC : ビットスタッフィング
* HDLCパケットの基本的なカプセル化形式
    * 各フレームをバイト0x7E (バイナリで 0111 1110) で開始および終了する。
    * 問題
        * このバイトパターンはがデータでも発生する。
    
<!--
非同期シリアル回線は、通常はバイト間で、ある種の開始/停止表示がある回線です。そのような線は遅くなる傾向があります。この種の回線では、HDLCはバイト0x7Dをエスケープ文字として使用します。0x7Dおよび0x7Eのデータバイトは、それらの前に追加の0x7Dを付けることでエスケープされます。（実際には、0x7Dの後に（original_byte xor 0x20）が続くものとして送信されます。）この戦略は、Cプログラミング言語の文字列で使用される戦略と基本的に同じです。文字列の区切り文字は「」で、エスケープ文字は「\」です。文字列内での「または\ 」の出現は、それらの前に\を付けることでエスケープされます。

同期シリアル回線（通常は非同期よりも高速）では、HDLCは通常ビットスタッフィングを使用します。基礎となるビットエンコーディングには、たとえば、NRZIの逆が含まれ、遷移は0ビットを示し、遷移の欠如は1ビットを示します。これは、1の長時間の実行が問題になり、0の実行が安全であることを意味します。

5つの連続した1ビットが、データ内に現れるたびに、例えば011111送信ハードウェア（かかわらず、次のデータ・ビットも1であるか否か）によって、0ビットは、その後、挿入された、または「ぬいぐるみ」。したがって、0x7E = 0111 1110のHDLCフレームバイトは、6つの1ビットが連続して含まれているため、エンコードされたデータとして表示されることはありません。我々はデータで0x7Eをしていた場合、それは0111 11として送信される0 10。

HDLC受信機はそれを知っています

連続する6つの1ビットはパケットの終わりを示します
5つの1ビットが連続して表示され、その後に0ビットが続く場合、0ビットは削除されます。
例：

データ：011110 0111110 01111110
送信者：011110 011111 0 0 011111 0 10（太字のビットの詰め込み）

ビットスタッフィングは、HDLCが2つの無関係な問題を解決するために使用することに注意してください。同じビットを長時間実行するとレシーバーのカウントが失われる同期の問題と、送信されたビットパターン01111110が決してできないフラグを表すフレーミングの問題です。データバイトと間違えられます。

### B8ZS 

時折余分なビットまたはバイトを挿入することはデータ配信にとって問題ではありませんが、音声エンジニアにとっては嫌悪感です。余分なビットは、正確な64 kbpsDS-0レートを混乱させます。その結果、長い通信回線は、4B / 5Bのように、タイミングの変動を引き起こさないエンコーディングを好みます。非常に長い（電気）ラインでも、長期平均電圧レベル0を保証するエンコーディングが必要になる傾向があります（NRZでビットの半分が1 vで、半分が0 vの場合は0.5）。つまり、信号にDC成分があってはなりません。

AMI（代替マーク反転）技術は、名目上+1、3つの電圧レベルを用いて、DC成分を除去0及び-1。この3値エンコーディングは、バイポーラとも呼ばれます。ゼロビットは0電圧でエンコードされ、1ビットは+1ボルトと-1ボルトの交互の値を取ります。したがって、ビット011101は、0、+ 1、-1、+ 1,0、-1、またはよりコンパクトに0 +-+ 0-としてエンコードされる可能性があります。長期的には、+ 1と-1はキャンセルされます。

プレーンAMIには、0ビットの長時間実行で同期の問題がまだあります。北米のT1回線（1.544 Mbps）で使用されるソリューションは、8ゼロ置換のバイポーラ用のB8ZSとして知られています。送信側は、8つのゼロビットの実行を、000 + -0- +または000- + 0 +-のいずれかの特別なビットパターンに置き換えます。どちらを決定するために、送信者は、前に送信された1ビットが+1または-1であったかどうかを確認します。前者の場合は最初のパターンが置換され、後者の場合は2番目のパターンが置換されます。いずれにせよ、これは、連続する1ビットが反対の符号を持つという規則違反の2つのインスタンスにつながります。たとえば、前のビットが+だった場合、受信者は

_images / b8zs.svg
この二重違反は、特別なパターンが削除され、元の8つの0ビットに置き換えられるという受信者への手がかりです。
-->